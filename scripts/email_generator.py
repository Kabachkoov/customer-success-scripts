#!/usr/bin/env python3
"""
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–∏—Å–µ–º –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏.
–°–æ–∑–¥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ –¥–ª—è 10+ —Ä–∞–±–æ—á–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º.
"""

import json
import os
from datetime import datetime

class EmailGenerator:
    """–£–º–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∏—Å–µ–º —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ –∏—Å—Ç–æ—Ä–∏–µ–π."""
    
    def __init__(self):
        self.templates = self._load_templates()
        self.history_file = "email_history.json"
        self.history = self._load_history()
    
    def _load_templates(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É —à–∞–±–ª–æ–Ω–æ–≤ –ø–∏—Å–µ–º."""
        return {
            # 1. –û–ù–ë–û–†–î–ò–ù–ì –ö–õ–ò–ï–ù–¢–ê
            "onboarding": {
                "subject": "üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ [Product Name], {client_name}!",
                "body": """–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {client_name},

–û—Ç –≤—Å–µ–π –∫–æ–º–∞–Ω–¥—ã [Product Name] –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –í–∞—Å –∏ {company_name} —Å—Ä–µ–¥–∏ –Ω–∞—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤!

–ú–µ–Ω—è –∑–æ–≤—É—Ç {manager_name}, —è –±—É–¥—É –≤–∞—à–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏. 
–ú–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ—á—å –≤–∞–º –ø–æ–ª—É—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å –æ—Ç –Ω–∞—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞.

üìÖ **–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏:**
1. **–í–≤–æ–¥–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞** (30 –º–∏–Ω—É—Ç) ‚Äî –æ–±—Å—É–¥–∏–º –≤–∞—à–∏ —Ü–µ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–∏–º –ø—Ä–æ—Ü–µ—Å—Å—ã
2. **–û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã** ‚Äî –ø—Ä–æ–≤–µ–¥–µ–º –¥–µ–º–æ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
3. **–ü–µ—Ä–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** ‚Äî —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏ –ø–æ–¥–≤–µ–¥–µ–º –ø–µ—Ä–≤—ã–µ –∏—Ç–æ–≥–∏

üìå **–°–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:**
‚Ä¢ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫—É—é –∞–Ω–∫–µ—Ç—É –æ –±–∏–∑–Ω–µ—Å–µ: [—Å—Å—ã–ª–∫–∞]
‚Ä¢ –ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –¥–ª—è –≤–≤–æ–¥–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∏: [Calendly —Å—Å—ã–ª–∫–∞]
‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ –≤ —á–∞—Ç –≤–∞—à—É –∫–æ–º–∞–Ω–¥—É (–¥–æ 5 —á–µ–ª–æ–≤–µ–∫)

–Ø –Ω–∞ —Å–≤—è–∑–∏ –¥–ª—è –ª—é–±—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤!

–° –Ω–∞–∏–ª—É—á—à–∏–º–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏,
{manager_name}
{manager_title}
[Product Name]""",
                "tags": ["–æ–Ω–±–æ—Ä–¥–∏–Ω–≥", "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ", "—Å—Ç–∞—Ä—Ç"]
            },
            
            # 2. FOLLOW-UP –ü–û–°–õ–ï –í–°–¢–†–ï–ß–ò
            "meeting_follow_up": {
                "subject": "üìù –†–µ–∑—é–º–µ –Ω–∞—à–µ–π –≤—Å—Ç—Ä–µ—á–∏ –æ—Ç {meeting_date}",
                "body": """–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {client_name},

–ë–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—É—é –≤—Å—Ç—Ä–µ—á—É {meeting_date}!

–ö–∞–∫ –∏ –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å, —Ä–µ–∑—é–º–∏—Ä—É—é –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏ –¥–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏:

üìå **–û–±—Å—É–∂–¥–∞–µ–º—ã–µ —Ç–µ–º—ã:**
{meeting_summary}

‚úÖ **–î–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è:**
{agreements}

üìã **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (Action Items):**

**–° –Ω–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã:**
{our_action_items}

**–° –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã:**
{client_action_items}

üóìÔ∏è **–°–ª–µ–¥—É—é—â–∞—è –≤—Å—Ç—Ä–µ—á–∞:** {next_meeting_date}
üéØ **–¶–µ–ª—å:** {next_meeting_goal}

–ë—É–¥—É –ø—Ä–∏–∑–Ω–∞—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—é–º–µ.

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{manager_name}
{manager_title}""",
                "tags": ["follow-up", "–≤—Å—Ç—Ä–µ—á–∞", "–¥–µ–π—Å—Ç–≤–∏—è"]
            },
            
            # 3. –ü–†–û–§–ò–õ–ê–ö–¢–ò–ö–ê –û–¢–¢–û–ö–ê
            "churn_prevention": {
                "subject": "{client_name}, –¥–∞–≤–∞–π—Ç–µ –æ–±—Å—É–¥–∏–º –≤–∞—à –æ–ø—ã—Ç",
                "body": """–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {client_name}!

–ó–∞–º–µ—Ç–∏–ª–∏, —á—Ç–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ —Å–Ω–∏–∑–∏–ª–∞—Å—å –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è. 
–î–ª—è –Ω–∞—Å –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –≤—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –ø–æ–ª—É—á–∞—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å –æ—Ç [Product Name].

–í–æ–∑–º–æ–∂–Ω–æ:
‚Ä¢ –ï—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏–ª–∏ –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è?
‚Ä¢ –ò–∑–º–µ–Ω–∏–ª–∏—Å—å –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã?
‚Ä¢ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏?

–ü—Ä–µ–¥–ª–∞–≥–∞—é –∫–æ—Ä–æ—Ç–∫–∏–π —Å–æ–∑–≤–æ–Ω (15-20 –º–∏–Ω—É—Ç) –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ, —á—Ç–æ–±—ã:
1. –û–±—Å—É–¥–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
2. –ü–æ–º–æ—á—å –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å—Ç–∞–≤–∏–ª–∏ –≤–Ω–∞—á–∞–ª–µ
3. –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã

–î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è: [—Å—Å—ã–ª–∫–∞ –Ω–∞ Calendly]

–î–∞–∂–µ –µ—Å–ª–∏ –≤—Å—ë —Ö–æ—Ä–æ—à–æ ‚Äî –±—É–¥—É —Ä–∞–¥ –ø–æ–ª—É—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å!

–° –Ω–∞–∏–ª—É—á—à–∏–º–∏ –ø–æ–∂–µ–≤–∞–Ω–∏—è–º–∏,
{manager_name}""",
                "tags": ["–æ—Ç—Ç–æ–∫", "—É–¥–µ—Ä–∂–∞–Ω–∏–µ", "–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"]
            },
            
            # 4. –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û–ë –û–ë–ù–û–í–õ–ï–ù–ò–ò
            "product_update": {
                "subject": "üéÅ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ [Product Name]!",
                "body": """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º, {client_name}!

–†–∞–¥—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≤–∞–∂–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ [Product Name]:

‚ú® **–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
{new_features}

üöÄ **–ö–∞–∫ —ç—Ç–æ —É–ª—É—á—à–∏—Ç –≤–∞—à workflow:**
{benefits}

üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –æ–±—É—á–µ–Ω–∏–µ:**
‚Ä¢ [–í–∏–¥–µ–æ-–¥–µ–º–æ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π]
‚Ä¢ [–°—Ç–∞—Ç—å—è –≤ –ë–∞–∑–µ –ó–Ω–∞–Ω–∏–π]
‚Ä¢ [–í–µ–±–∏–Ω–∞—Ä] {webinar_date}

üí° **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
{recommended_actions}

–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º ‚Äî —Å —Ä–∞–¥–æ—Å—Ç—å—é –ø—Ä–æ–≤–µ–¥—ë–º –¥–µ–º–æ!

–ö–æ–º–∞–Ω–¥–∞ [Product Name]""",
                "tags": ["–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ", "–Ω–æ–≤–æ—Å—Ç–∏", "features"]
            },
            
            # 5. QBR (–ï–ñ–ï–ö–í–ê–†–¢–ê–õ–¨–ù–´–ô –û–ë–ó–û–†)
            "qbr_invitation": {
                "subject": "üìä –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–æ–±–∑–æ—Ä (QBR)",
                "body": """–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {client_name},

–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –≤–∞—Å –Ω–∞ –ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π –ë–∏–∑–Ω–µ—Å-–û–±–∑–æ—Ä (QBR) {quarter}.

üéØ **–¶–µ–ª—å –≤—Å—Ç—Ä–µ—á–∏:**
1. –ü–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –∑–∞ {quarter}
2. –û–±—Å—É–¥–∏—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ KPI
3. –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –Ω–∞ {next_quarter}
4. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è roadmap –ø—Ä–æ–¥—É–∫—Ç–∞

üìà **–ß—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º –º—ã:**
‚Ä¢ –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
‚Ä¢ –û—Ç—á—ë—Ç –ø–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–º —Ü–µ–ª—è–º
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
‚Ä¢ –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª

‚è∞ **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 60 –º–∏–Ω—É—Ç
üìÖ **–î–∞—Ç–∞:** {meeting_date}
üìç **–§–æ—Ä–º–∞—Ç:** {meeting_format}

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è: [—Å—Å—ã–ª–∫–∞ –Ω–∞ Calendly]

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{manager_name}""",
                "tags": ["qbr", "–æ—Ç—á–µ—Ç", "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"]
            },
            
            # 6. –ë–õ–ê–ì–û–î–ê–†–ù–û–°–¢–¨ –ó–ê –û–¢–ó–´–í
            "thank_you_feedback": {
                "subject": "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–∑—ã–≤, {client_name}!",
                "body": """–£–≤–∞–∂–∞–µ–º—ã–π(–∞—è) {client_name},

–ë–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–∑—ã–≤ –∏ –æ—Ü–µ–Ω–∫—É {nps_score}!

–í–∞—à–µ –º–Ω–µ–Ω–∏–µ –æ—á–µ–Ω—å —Ü–µ–Ω–Ω–æ –¥–ª—è –Ω–∞—Å –∏ –ø–æ–º–æ–≥–∞–µ—Ç —É–ª—É—á—à–∞—Ç—å [Product Name].

üìå **–ß—Ç–æ –º—ã –¥–µ–ª–∞–µ–º —Å –≤–∞—à–∏–º —Ñ–∏–¥–±–µ–∫–æ–º:**
{feedback_actions}

üåü **–û—Å–æ–±–µ–Ω–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä–Ω—ã –∑–∞:**
{positive_feedback}

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º—ã—Å–ª–∏ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –≤—Å–µ–≥–¥–∞ —Ä–∞–¥—ã —É—Å–ª—ã—à–∞—Ç—å!

–° –Ω–∞–∏–ª—É—á—à–∏–º–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏,
–ö–æ–º–∞–Ω–¥–∞ [Product Name]""",
                "tags": ["–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å", "feedback", "nps"]
            },
            
            # 7. –ê–ü–°–ï–ô–õ / –ö–†–û–°–°-–°–ï–õ–õ
            "upsell_proposal": {
                "subject": "üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–æ—Å—Ç–∞ —Å [Product Name]",
                "body": """{client_name}, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!

–û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –≤–∞—à–µ–º —Ç–µ–∫—É—â–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ [Product Name], –º—ã –≤–∏–¥–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –µ—â—ë –±–æ–ª—å—à–µ–≥–æ —Ä–æ—Å—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

üìä **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
{usage_analysis}

üéØ **–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
{upsell_features}

üí∞ **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤—ã–≥–æ–¥—ã:**
‚Ä¢ –≠–∫–æ–Ω–æ–º–∏—è: {savings_per_month} —Ä—É–±./–º–µ—Å
‚Ä¢ –ü—Ä–∏—Ä–æ—Å—Ç –≤—ã—Ä—É—á–∫–∏: {revenue_increase} —Ä—É–±./–º–µ—Å
‚Ä¢ ROI: {roi_percentage}%

üìÖ **–ü—Ä–µ–¥–ª–∞–≥–∞—é –æ–±—Å—É–¥–∏—Ç—å:** {meeting_date}
‚è∞ **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 30 –º–∏–Ω—É—Ç

–ì–æ—Ç–æ–≤ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω—ã–º —Ä–∞—Å—á—ë—Ç–æ–º –∏ –¥–µ–º–æ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π!

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
{manager_name}""",
                "tags": ["upsell", "–ø—Ä–æ–¥–∞–∂–∏", "—Ä–æ—Å—Ç"]
            }
        }
    
    def _load_history(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º."""
        if os.path.exists(self.history_file):
            try:
                with open(self.history_file, 'r', encoding='utf-8') as f:
                    return json.load(f)
            except:
                return []
        return []
    
    def _save_history(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –≤ —Ñ–∞–π–ª."""
        with open(self.history_file, 'w', encoding='utf-8') as f:
            json.dump(self.history, f, ensure_ascii=False, indent=2)
    
    def generate_email(self, template_name, **kwargs):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∏—Å—å–º–æ –ø–æ —à–∞–±–ª–æ–Ω—É."""
        if template_name not in self.templates:
            available = ", ".join(self.templates.keys())
            return f"‚ùå –®–∞–±–ª–æ–Ω '{template_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ—Å—Ç—É–ø–Ω—ã–µ: {available}"
        
        template = self.templates[template_name]
        
        # –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
        subject = template["subject"].format(**kwargs)
        body = template["body"].format(**kwargs)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        email_record = {
            "template": template_name,
            "subject": subject,
            "recipient": kwargs.get('client_name', 'Unknown'),
            "date": datetime.now().strftime("%Y-%m-%d %H:%M"),
            "tags": template["tags"]
        }
        self.history.append(email_record)
        self._save_history()
        
        return f"""‚úâÔ∏è –ü–ò–°–¨–ú–û –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–û
{'='*50}
üìß –ö–û–ú–£: {kwargs.get('client_name', '–ö–ª–∏–µ–Ω—Ç')}
üè¢ –ö–û–ú–ü–ê–ù–ò–Ø: {kwargs.get('company_name', '')}
üè∑Ô∏è –¢–ò–ü: {template_name}
üìÖ –î–ê–¢–ê: {datetime.now().strftime('%d.%m.%Y %H:%M')}
üìé –¢–ï–ì–ò: {', '.join(template['tags'])}

{'='*50}
–¢–ï–ú–ê: {subject}

{'='*50}
{body}

{'='*50}
‚úÖ –ü–∏—Å—å–º–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∏—Å—Ç–æ—Ä–∏—é (#{len(self.history)})
"""
    
    def show_statistics(self):
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è."""
        if not self.history:
            return "üìä –ò—Å—Ç–æ—Ä–∏—è –ø–∏—Å–µ–º –ø—É—Å—Ç–∞."
        
        total = len(self.history)
        stats = {}
        for record in self.history:
            tpl = record["template"]
            stats[tpl] = stats.get(tpl, 0) + 1
        
        result = ["üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ì–ï–ù–ï–†–ê–¢–û–†–ê –ü–ò–°–ï–ú", "="*40]
        result.append(f"üì® –í—Å–µ–≥–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: {total} –ø–∏—Å–µ–º")
        result.append("\nüìà –ü–æ —Ç–∏–ø–∞–º –ø–∏—Å–µ–º:")
        
        for tpl, count in sorted(stats.items(), key=lambda x: x[1], reverse=True):
            percentage = (count / total) * 100
            result.append(f"  ‚Ä¢ {tpl}: {count} ({percentage:.1f}%)")
        
        # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–∏—Å–µ–º
        result.append("\nüïê –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–∏—Å—å–º–∞:")
        for record in self.history[-5:]:
            result.append(f"  ‚Ä¢ {record['date']}: {record['recipient']} ({record['template']})")
        
        return "\n".join(result)
    
    def search_history(self, keyword):
        """–ò—â–µ—Ç –ø–∏—Å—å–º–∞ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É."""
        results = []
        keyword_lower = keyword.lower()
        
        for record in self.history:
            if (keyword_lower in record["recipient"].lower() or 
                keyword_lower in record["template"].lower() or
                keyword_lower in record["subject"].lower() or
                any(keyword_lower in tag.lower() for tag in record["tags"])):
                results.append(record)
        
        if not results:
            return f"üîç –ü–æ –∑–∞–ø—Ä–æ—Å—É '{keyword}' –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ."
        
        result_text = [f"üîç –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê: '{keyword}'", "="*40]
        for record in results:
            result_text.append(f"\nüìß {record['recipient']}")
            result_text.append(f"   –¢–µ–º–∞: {record['subject']}")
            result_text.append(f"   –¢–∏–ø: {record['template']}")
            result_text.append(f"   –î–∞—Ç–∞: {record['date']}")
        
        return "\n".join(result_text)


def interactive_mode():
    """–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º."""
    generator = EmailGenerator()
    
    print("="*60)
    print("üìß –ì–ï–ù–ï–†–ê–¢–û–† –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–• –ü–ò–°–ï–ú –î–õ–Ø CSM")
    print("="*60)
    
    while True:
        print("\n" + "="*40)
        print("üìã –î–û–°–¢–£–ü–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø:")
        print("  1. üìù –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Å—å–º–æ")
        print("  2. üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É")
        print("  3. üîç –ü–æ–∏—Å–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏")
        print("  4. üìÅ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è")
        print("  5. ‚ùå –í—ã—Ö–æ–¥")
        print("="*40)
        
        choice = input("\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (1-5): ").strip()
        
        if choice == "1":
            print("\nüìù –î–û–°–¢–£–ü–ù–´–ï –®–ê–ë–õ–û–ù–´:")
            templates = list(generator.templates.keys())
            for i, tpl in enumerate(templates, 1):
                print(f"  {i}. {tpl} - {generator.templates[tpl]['tags'][0]}")
            
            try:
                tpl_choice = int(input("\n–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω (–Ω–æ–º–µ—Ä): ")) - 1
                if 0 <= tpl_choice < len(templates):
                    template_name = templates[tpl_choice]
                    
                    print(f"\nüìã –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∞ '{template_name}':")
                    params = {}
                    
                    # –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                    params['client_name'] = input("–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞: ") or "–ê–ª–µ–∫—Å–µ–π"
                    params['company_name'] = input("–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏: ") or "–û–û–û '–¢–µ—Ö–Ω–æ–ü—Ä–æ—Ñ–∏—Ç'"
                    params['manager_name'] = input("–í–∞—à–µ –∏–º—è: ") or "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
                    params['manager_title'] = input("–í–∞—à–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å: ") or "–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏"
                    
                    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —à–∞–±–ª–æ–Ω–∞
                    if template_name == "meeting_follow_up":
                        params['meeting_date'] = input("–î–∞—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏ (–¥–¥.–º–º.–≥–≥–≥–≥): ") or "15.12.2025"
                        params['meeting_summary'] = input("–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏: ") or "–û–±—Å—É–¥–∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é API –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ—Ç—á–µ—Ç–æ–≤"
                        params['agreements'] = input("–î–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ") or "‚Ä¢ –ù–∞—Å—Ç—Ä–æ–∏–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –¥–æ 20.12\n‚Ä¢ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤–æ–º—É –º–æ–¥—É–ª—é"
                        params['our_action_items'] = input("–ù–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è: ") or "‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ API\n‚Ä¢ –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞"
                        params['client_action_items'] = input("–î–µ–π—Å—Ç–≤–∏—è –∫–ª–∏–µ–Ω—Ç–∞: ") or "‚Ä¢ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–µ\n‚Ä¢ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Ç—á–µ—Ç–∞–º"
                        params['next_meeting_date'] = input("–î–∞—Ç–∞ —Å–ª–µ–¥. –≤—Å—Ç—Ä–µ—á–∏: ") or "22.12.2025"
                        params['next_meeting_goal'] = input("–¶–µ–ª—å —Å–ª–µ–¥. –≤—Å—Ç—Ä–µ—á–∏: ") or "–û–±—Å—É–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
                    
                    elif template_name == "qbr_invitation":
                        params['quarter'] = input("–ö–≤–∞—Ä—Ç–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, Q4 2025): ") or "Q4 2025"
                        params['next_quarter'] = input("–°–ª–µ–¥—É—é—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª: ") or "Q1 2026"
                        params['meeting_date'] = input("–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –¥–∞—Ç–∞: ") or "25.12.2025"
                        params['meeting_format'] = input("–§–æ—Ä–º–∞—Ç (online/–æ—Ñ—Ñ–ª–∞–π–Ω): ") or "online"
                    
                    result = generator.generate_email(template_name, **params)
                    print("\n" + result)
                    
                else:
                    print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä —à–∞–±–ª–æ–Ω–∞.")
            except ValueError:
                print("‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ.")
        
        elif choice == "2":
            print("\n" + generator.show_statistics())
        
        elif choice == "3":
            keyword = input("–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞: ").strip()
            if keyword:
                print("\n" + generator.search_history(keyword))
        
        elif choice == "4":
            print("\n" + "="*40)
            print("üìö –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:")
            print("\n–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É 'emails' –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –ø–∏—Å–µ–º:")
            print("  mkdir emails")
            print("\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ:")
            print("  python email_generator.py")
            print("\n–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏:")
            print("  from email_generator import EmailGenerator")
            print("  generator = EmailGenerator()")
            print("  email = generator.generate_email('onboarding', client_name='–ê–ª–µ–∫—Å–µ–π')")
        
        elif choice == "5":
            print("\nüëã –î–æ –Ω–æ–≤—ã—Ö –≤—Å—Ç—Ä–µ—á! –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ follow-up!")
            break
        
        else:
            print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")


# =================== –ü–†–ò–ú–ï–†–´ –ë–´–°–¢–†–û–ì–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø ===================
if __name__ == "__main__":
    print("="*70)
    print("üöÄ –ì–ï–ù–ï–†–ê–¢–û–† –ü–ò–°–ï–ú –î–õ–Ø –ú–ï–ù–ï–î–ñ–ï–†–ê –ü–û –†–ê–ë–û–¢–ï –° –ö–õ–ò–ï–ù–¢–ê–ú–ò")
    print("="*70)
    
    # –ë—ã—Å—Ç—Ä–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
    generator = EmailGenerator()
    
    # –ü—Ä–∏–º–µ—Ä 1: –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
    print("\n" + "="*70)
    print("üìã –ü–†–ò–ú–ï–† 1: –ü–∏—Å—å–º–æ –¥–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞")
    print("="*70)
    
    onboarding_email = generator.generate_email(
        template_name="onboarding",
        client_name="–ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤",
        company_name="–û–û–û '–¢–µ—Ö–Ω–æ–õ–∏–¥–µ—Ä'",
        manager_name="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        manager_title="–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ —É—Å–ø–µ—Ö—É –∫–ª–∏–µ–Ω—Ç–æ–≤"
    )
    print(onboarding_email[:500] + "...\n(–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –∏—Å—Ç–æ—Ä–∏–∏)")
    
    # –ü—Ä–∏–º–µ—Ä 2: Follow-up –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏
    print("\n" + "="*70)
    print("üìã –ü–†–ò–ú–ï–† 2: Follow-up –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏")
    print("="*70)
    
    follow_up_email = generator.generate_email(
        template_name="meeting_follow_up",
        client_name="–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞",
        company_name="–ì–ö '–°—Ç—Ä–æ–π–ì—Ä–∞–¥'",
        manager_name="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        manager_title="Senior CSM",
        meeting_date="14.12.2025",
        meeting_summary="–û–±—Å—É–¥–∏–ª–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–¥—É–ª—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å CRM",
        agreements="‚Ä¢ –í–Ω–µ–¥—Ä–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å –¥–æ 25.12\n‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è 3 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",
        our_action_items="‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Ö–∑–∞–¥–∞–Ω–∏–µ\n‚Ä¢ –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–∞—Ç—É –¥–µ–º–æ-—Å–µ—Å—Å–∏–∏",
        client_action_items="‚Ä¢ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫\n‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö",
        next_meeting_date="28.12.2025",
        next_meeting_goal="–û–±—Å—É–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è"
    )
    print(follow_up_email[:500] + "...\n(–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –∏—Å—Ç–æ—Ä–∏–∏)")
    
    # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    print("\n" + "="*70)
    print(generator.show_statistics())
    print("="*70)
    
    # –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    use_interactive = input("\n‚ú® –ü–µ—Ä–µ–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º? (–¥–∞/–Ω–µ—Ç): ").lower()
    if use_interactive in ['–¥–∞', 'yes', 'y', '–¥']:
        interactive_mode()
    else:
        print("\nüí° –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞.")
        print("   –ò–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª–∞—Å—Å –≤ —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã:")
        print("   from email_generator import EmailGenerator")
    
    print("\n" + "="*70)
    print("‚úÖ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! –°–æ–∑–¥–∞–Ω–æ –ø–∏—Å–µ–º:", len(generator.history))
    print("="*70)
